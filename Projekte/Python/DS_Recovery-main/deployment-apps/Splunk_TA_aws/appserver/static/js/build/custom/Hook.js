import{_ as e,a as t,g as n,h as a,d as s,i}from"./_rollupPluginBabelHelpers-deef47fd.js";import{P as r,r as o,R as u,e as l,f as c,g as d,h as f,F as _,j as m,b as v,m as h,$ as p,o as g,c as w,k as b,l as S}from"./vendor-e1fcc605.js";import{a as N,d as y}from"./SourceInput-760b23b7.js";import{g as k}from"./GlobalConfigUtil-2d540963.js";import{T as x}from"./Theme-fcd59ca3.js";var q=new(function(){function n(){t(this,n)}return e(n,[{key:"getServiceLocationMap",value:function(){return{aws_description:"aws.description",aws_config:"aws.config",aws_config_rule:"aws.configrules",aws_cloudwatch:"aws.cloudwatch",aws_cloudwatch_logs:"aws.cloudwatchlogs",aws_s3:"aws.s3",splunk_ta_aws_logs:"aws.incrementals3",aws_sqs_based_s3:"aws.sqs_based_s3",aws_billing:"aws.billing",aws_billing_cur:"aws.billing.cur",aws_cloudtrail:"aws.cloudtrail",aws_kinesis:"aws.kinesis",aws_inspector:"aws.inspector",splunk_ta_aws_sqs:"aws.sqs"}}},{key:"getAllLinks",value:function(){return{SQS_BASED_S3:"aws.configure_aws.configure_sqs"}}},{key:"buildInputLink",value:function(e){var t=E()[e];return'<a data-test="link" target="_blank" class="imDUvl" href="/help?location='.concat(encodeURIComponent("[AddOns:released]")).concat(t,'">').concat("Learn more",'<svg focusable="false" height="8px" width="8px" viewBox="0 0 1500 1499" aria-hidden="false" class="help-link-icon"><path d="M1500 1125h-189.04v185.96H189.04V189.04H375V0H0v1500h1500v-375zm0-1125H723.288v190.068h469.52l-666.78 648.288 133.56 134.59 650.344-665.754v469.52l189.04 1.028L1500 0z"></path></svg></a>')}}]),n}()),R=q.buildInputLink;q.getAllLinks;var E=q.getServiceLocationMap,F=o.exports.createContext({regions:[],setRegions:function(){},queues:[],setQueues:function(){},effectiveState:{},setEffectiveState:function(){}}),j=function(e){var t=e.hookProps,a=e.children,s=t.initFormRows,i=t.setFormState,r=t.serviceName,l=t.initAccount,c=o.exports.useState(l),d=n(c,2),f=d[0],_=d[1],m=o.exports.useState(s),v=n(m,2),h=v[0],p=v[1],g=o.exports.useState({}),w=n(g,2),b=w[0],S=w[1],N=o.exports.useState({}),y=n(N,2),k=y[0],x=y[1],q=o.exports.useState({}),R=n(q,2),E=R[0],j=R[1];return u.createElement(F.Provider,{value:{setFormState:i,serviceName:r,account:f,setAccount:_,effectiveFormRows:h,setEffectiveFormRows:p,regions:b,setRegions:S,queues:k,setQueues:x,rules:E,setRules:j},__self:undefined,__source:{fileName:"/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/hooks/useFormData.jsx",lineNumber:29,columnNumber:5}},a)};j.propTypes={children:r.oneOfType([r.arrayOf(r.node),r.node]).isRequired};var M=function(){return o.exports.useContext(F)},O="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/QueueInput.jsx",T={flex:"1 0 0",borderColor:"rgb(195, 203, 212)"},L=/REST Error \[([0-9]+)\]: (.*)\\".  See/;function C(e){var t=this,s=e.initValue,i=e.effectiveRegion,r=e.index,f=e.handleFormStateUpdate,_=M(),m=_.queues,v=_.setQueues,h=_.account,p=_.setFormState,g=o.exports.useState(s),w=n(g,2),b=w[0],S=w[1],N=o.exports.useState([]),y=n(N,2),k=y[0],x=y[1],q=o.exports.useState(!1),R=n(q,2),E=R[0],F=R[1],j=o.exports.useState(i),C=n(j,2),U=C[0],V=C[1],D=function(e){e&&f(r,i,null),S(),x([]),F(!1)};return o.exports.useEffect((function(){var e;h||D(!1),void 0!==(null===(e=m[h])||void 0===e?void 0:e[i])&&(x(m[h][i].map((function(e){return u.createElement(l.Option,{label:e.label,value:e.value,__self:t,__source:{fileName:O,lineNumber:46,columnNumber:29}})}))),i!==U&&(V(i),f(r,i,null),S()),F(!1))}),[h,i,m]),o.exports.useEffect((function(){var e;if(h&&i&&void 0===(null===(e=m[h])||void 0===e?void 0:e[i])){F(!0);var t=new URL(c("splunk_ta_aws/splunk_ta_aws_sqs_queue_names"),location),n={aws_account:h,aws_region:i,output_mode:"json",count:"0"},s={"X-Splunk-Form-Key":d,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"};t.search=new URLSearchParams(n).toString(),fetch(t,{method:"GET",headers:s}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){var t=(null==e?void 0:e.entry)||[],n=a({},m);n[h]=void 0===n[h]?{}:n[h],n[h][i]=t.map((function(e){return{label:e.name,value:e.name}})),v(n)})).catch((function(e){D(!0);var t="Failed to get SQS Queue for Region ".concat(i,". ");"function"==typeof e.text?e.text().then((function(e){var n=e.match(L);n&&3===n.length?t+="[".concat(n[1],"] ").concat(n[2]):t+=e,p((function(e){var n=a({},e);return n.errorMsg=t,n}))})):(t+=e,p((function(e){var n=a({},e);return n.errorMsg=t,n})))}))}}),[h,i]),u.createElement(l,{value:b,onChange:function(e,t){var n=t.value;f(r,i,n),S(n)},disabled:E,placeholder:E?"Loading...":"Select an account and a region first",style:T,filter:!0,inline:!0,__self:this,__source:{fileName:O,lineNumber:140,columnNumber:5}},k)}var U=o.exports.memo(C),V="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/RulesInput.jsx",D={flex:"1 0 0",borderColor:"rgb(195, 203, 212)"},P=/REST Error \[([0-9]+)\]: (.*)\\".  See/;function Q(e){var t=this,s=e.initValue,i=e.effectiveRegion,r=e.index,l=e.handleFormStateUpdate,_=M(),m=_.rules,v=_.setRules,h=_.account,p=_.setFormState,g=o.exports.useState(s),w=n(g,2),b=w[0],S=w[1],N=o.exports.useState([]),y=n(N,2),k=y[0],x=y[1],q=o.exports.useState(!1),R=n(q,2),E=R[0],F=R[1],j=o.exports.useState(i),O=n(j,2),T=O[0],L=O[1],C=function(e){e&&l(r,i,[]),S([]),x([]),F(!1)};return o.exports.useEffect((function(){var e;h||C(!1),void 0!==(null===(e=m[h])||void 0===e?void 0:e[i])&&(x(m[h][i].map((function(e){return u.createElement(f.Option,{label:e.label,value:e.value,__self:t,__source:{fileName:V,lineNumber:47,columnNumber:7}})}))),i!==T&&(L(i),l(r,i,[]),S([])),F(!1))}),[h,i,m]),o.exports.useEffect((function(){var e;if(h&&i&&void 0===(null===(e=m[h])||void 0===e?void 0:e[i])){F(!0);var t=new URL(c("splunk_ta_aws/splunk_ta_aws_config_rules"),location),n={aws_account:h,aws_region:i,output_mode:"json",count:"0"},s={"X-Splunk-Form-Key":d,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"};t.search=new URLSearchParams(n).toString(),fetch(t,{method:"GET",headers:s}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){var t=(null==e?void 0:e.entry)||[],n=a({},m);n[h]=void 0===n[h]?{}:n[h],n[h][i]=t.map((function(e){return{label:e.name,value:e.name}})),v(n)})).catch((function(e){C(!0);var t="Failed to get Config Rules for Region ".concat(i,". ");"function"==typeof e.text?e.text().then((function(e){var n=e.match(P);n&&3===n.length?t+="[".concat(n[1],"] ").concat(n[2]):t+=e,p((function(e){var n=a({},e);return n.errorMsg=t,n}))})):(t+=e,p((function(e){var n=a({},e);return n.errorMsg=t,n})))}))}}),[h,i]),u.createElement(f,{values:b,onChange:function(e,t){var n=t.values;l(r,i,n),S(n)},disabled:E,placeholder:E?"Loading...":"Leave blank to select all rules in this region",style:D,inline:!0,__self:this,__source:{fileName:V,lineNumber:142,columnNumber:5}},k)}var A=o.exports.memo(Q),z="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/MultiQueueInput.jsx",H={flex:"1 0 0",borderColor:"rgb(195, 203, 212)"},Y=/REST Error \[([0-9]+)\]: (.*)\\".  See/;function J(e){var t=this,s=e.initValue,i=e.effectiveRegion,r=e.index,l=e.handleFormStateUpdate,_=M(),m=_.queues,v=_.setQueues,h=_.account,p=_.setFormState;_.effectiveFormRows;var g=o.exports.useState(s),w=n(g,2),b=w[0],S=w[1],N=o.exports.useState([]),y=n(N,2),k=y[0],x=y[1],q=o.exports.useState(!1),R=n(q,2),E=R[0],F=R[1],j=o.exports.useState(i),O=n(j,2),T=O[0],L=O[1],C=function(e){e&&l(r,i,[]),S([]),x([]),F(!1)};return o.exports.useEffect((function(){var e;h||C(!1),void 0!==(null===(e=m[h])||void 0===e?void 0:e[i])&&(x(m[h][i].map((function(e){return u.createElement(f.Option,{label:e.label,value:e.value,__self:t,__source:{fileName:z,lineNumber:48,columnNumber:7}})}))),i!==T&&(L(i),l(r,i,[]),S([])),F(!1))}),[h,i,m]),o.exports.useEffect((function(){var e;if(h&&i&&void 0===(null===(e=m[h])||void 0===e?void 0:e[i])){F(!0);var t=new URL(c("splunk_ta_aws/splunk_ta_aws_sqs_queue_names"),location),n={aws_account:h,aws_region:i,output_mode:"json",count:"0"},s={"X-Splunk-Form-Key":d,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"};t.search=new URLSearchParams(n).toString(),fetch(t,{method:"GET",headers:s}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){var t=(null==e?void 0:e.entry)||[],n=a({},m);n[h]=void 0===n[h]?{}:n[h],n[h][i]=t.map((function(e){return{label:e.name,value:e.name}})),v(n)})).catch((function(e){C(!0);var t="Failed to get SQS Queues for Region ".concat(i,". ");"function"==typeof e.text?e.text().then((function(e){var n=e.match(Y);n&&3===n.length?t+="[".concat(n[1],"] ").concat(n[2]):t+=e,p((function(e){var n=a({},e);return n.errorMsg=t,n}))})):(t+=e,p((function(e){var n=a({},e);return n.errorMsg=t,n})))}))}}),[h,i]),u.createElement(f,{values:b,onChange:function(e,t){var n=t.values;l(r,i,n),S(n)},disabled:E,placeholder:E?"Loading...":"Select an account and a region first",style:H,inline:!0,__self:this,__source:{fileName:z,lineNumber:143,columnNumber:5}},k)}var I=o.exports.memo(J),X="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/RegionInput.jsx",W={flex:"0 0 150px",display:"flex",alignItems:"center"},G=/REST Error \[([0-9]+)\]: (.*)\\".  See/;function B(e){var t=this,s=e.initValue,i=e.handleChangeRegion,r=e.index,f=e.handleFormStateUpdate,_=e.handleFormStateDelete,m=M(),v=m.regions,h=m.setRegions,p=m.serviceName,g=m.account,w=m.setFormState,b=o.exports.useState([]),S=n(b,2),N=S[0],y=S[1],k=o.exports.useState(!1),x=n(k,2),q=x[0],R=x[1],E=o.exports.useState(s),F=n(E,2),j=F[0],O=F[1],T=function(){_(r),O(),y([]),R(!1)};return o.exports.useEffect((function(){g||T(),void 0!==v[g]&&(y(v[g].map((function(e){return u.createElement(l.Option,{label:e.label,value:e.value,__self:t,__source:{fileName:X,lineNumber:60,columnNumber:7}})}))),R(!1))}),[g,v]),o.exports.useEffect((function(){if(g&&void 0===v[g]){R(!0);var e=new URL(c("splunk_ta_aws/splunk_ta_aws_regions"),location),t={aws_service:p,aws_account:g,output_mode:"json",count:"0"},n={"X-Splunk-Form-Key":d,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"};e.search=new URLSearchParams(t).toString(),fetch(e,{method:"GET",headers:n}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){var t=(null==e?void 0:e.entry)||[],n=a({},v);n[g]=t.map((function(e){return{label:e.content.label,value:e.name}})),h(n)})).catch((function(e){T();var t="Failed to get Region for Account ".concat(g,". ");"function"==typeof e.text?e.text().then((function(e){var n=e.match(G);n&&3===n.length?t+="[".concat(n[1],"] ").concat(n[2]):t+=e,w((function(e){var n=a({},e);return n.errorMsg=t,n}))})):(t+=e,w((function(e){var n=a({},e);return n.errorMsg=t,n})))}))}}),[g]),u.createElement("div",{style:W,__self:this,__source:{fileName:X,lineNumber:144,columnNumber:5}},u.createElement(l,{value:j,onChange:function(e,t){var n=t.value;O(n),i(n),f(r,n,"aws_config_rule"===p||"splunk_ta_aws_sqs"===p?[]:null),w((function(e){var t=a({},e);return t.errorMsg="",t}))},disabled:q,placeholder:q?"Loading...":"Select...",style:{width:"150px",minWidth:"100%",borderColor:"rgb(195, 203, 212)"},filter:!0,inline:!0,__self:this,__source:{fileName:X,lineNumber:145,columnNumber:7}},N))}var K=o.exports.memo(B),Z="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/SingleInputWrapper.jsx",$={display:"inline-flex",lineHeight:"32px",flex:"0 0 30px",justifyContent:"center",alignItems:"center"};function ee(e){var t=e.initValue,a=e.index,s=e.handleFormStateUpdate,i=e.handleFormStateDelete,r=o.exports.useState(null==t?void 0:t.region),l=n(r,2),c=l[0],d=l[1],f=M().serviceName;o.exports.useEffect((function(){return function(){i(a)}}),[]);var _=u.createElement(A,{initValue:null==t?void 0:t.rules,effectiveRegion:c,index:a,handleFormStateUpdate:s,__self:this,__source:{fileName:Z,lineNumber:40,columnNumber:5}});return"splunk_ta_aws_sqs"===f?_=u.createElement(I,{initValue:null==t?void 0:t.queues,effectiveRegion:c,index:a,handleFormStateUpdate:s,__self:this,__source:{fileName:Z,lineNumber:49,columnNumber:7}}):"aws_config"===f&&(_=u.createElement(U,{initValue:null==t?void 0:t.queues,effectiveRegion:c,index:a,handleFormStateUpdate:s,__self:this,__source:{fileName:Z,lineNumber:58,columnNumber:7}})),u.createElement("div",{style:{display:"flex"},__self:this,__source:{fileName:Z,lineNumber:68,columnNumber:5}},u.createElement(K,{initValue:null==t?void 0:t.region,handleChangeRegion:d,index:a,handleFormStateUpdate:s,handleFormStateDelete:i,__self:this,__source:{fileName:Z,lineNumber:69,columnNumber:7}}),u.createElement("span",{style:$,__self:this,__source:{fileName:Z,lineNumber:76,columnNumber:7}}),_)}var te=o.exports.memo(ee),ne="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/CustomFormRows.jsx";function ae(){var e=this,t=o.exports.useState([]),s=n(t,2),i=s[0],r=s[1],l=M(),c=l.setAccount,d=l.serviceName,f=l.setFormState,v=l.effectiveFormRows,h=l.setEffectiveFormRows;window.setAccount=function(e){c(e)},o.exports.useEffect((function(){var e=[],t=[],s=[];Object.entries(v).forEach((function(a){var i=n(a,2);i[0];var r=i[1];e.push(r.region),"aws_config_rule"===d?s.push(r.rules&&r.rules.join(",")):"splunk_ta_aws_sqs"===d?t.push(r.queues&&r.queues.join(",")):t.push(r.queues)})),f((function(n){var i=a({},n);return"aws_config_rule"===d?(i.data.region.value=0===e.length?JSON.stringify([""]):JSON.stringify(e),i.data.rule_names.value=0===s.length?JSON.stringify([""]):JSON.stringify(s)):"splunk_ta_aws_sqs"===d?(i.data.aws_region.value=0===e.length?JSON.stringify([""]):JSON.stringify(e),i.data.sqs_queues.value=0===t.length?JSON.stringify([""]):JSON.stringify(t)):(i.data.aws_region.value=0===e.length?JSON.stringify([""]):JSON.stringify(e),i.data.sqs_queue.value=0===t.length?JSON.stringify([""]):JSON.stringify(t)),i}))}),[v]);var p=function(e,t,n){h((function(s){var i=a({},s);return i[e]="aws_config_rule"===d?{region:t,rules:n}:{region:t,queues:n},i}))},g=function(e){h((function(t){var n=a({},t);return delete n[e],n}))},w=function(e,t){var n=t.index;r((function(e){return 1===e.length?e:_.removeRow(n,e)}))};o.exports.useEffect((function(){Object.entries(v).length>0?r(Object.entries(v).map((function(t,a){var s=n(t,2),i=s[0],r=s[1];return u.createElement(_.Row,{index:a,key:"uniqueRowUno",onRequestRemove:w,__self:e,__source:{fileName:ne,lineNumber:130,columnNumber:13}},u.createElement(te,{initValue:r,index:i,handleFormStateUpdate:p,handleFormStateDelete:g,__self:e,__source:{fileName:ne,lineNumber:135,columnNumber:15}}))}))):r([u.createElement(_.Row,{index:0,key:"uniqueRowUno",onRequestRemove:w,__self:e,__source:{fileName:ne,lineNumber:147,columnNumber:9}},u.createElement(te,{index:Date.now().toString(36)+Math.random().toString(36).substr(2),handleFormStateUpdate:p,handleFormStateDelete:g,__self:e,__source:{fileName:ne,lineNumber:152,columnNumber:11}}))])}),[]);var b="Config Rules";"splunk_ta_aws_sqs"===d?b="SQS Queues":"aws_config"===d&&(b="SQS Queue");var S=u.createElement("div",{__self:this,__source:{fileName:ne,lineNumber:170,columnNumber:5}},u.createElement("span",{style:{display:"inline-block",width:180},id:"header-key",__self:this,__source:{fileName:ne,lineNumber:171,columnNumber:7}},"Region"),u.createElement("span",{style:{display:"inline-block"},id:"header-value",__self:this,__source:{fileName:ne,lineNumber:180,columnNumber:7}},b));return u.createElement(_,{addLabel:"Add Another",header:S,onRequestAdd:function(){r((function(t){var n=Date.now().toString(36)+Math.random().toString(36).substr(2);return h((function(e){var t=a({},e);return t[n]={},t})),_.addRow(u.createElement(_.Row,{index:t.length,key:m(),onRequestRemove:w,__self:e,__source:{fileName:ne,lineNumber:109,columnNumber:9}},u.createElement(te,{index:n,handleFormStateUpdate:p,handleFormStateDelete:g,__self:e,__source:{fileName:ne,lineNumber:114,columnNumber:11}})),t)}))},style:{width:500},__self:this,__source:{fileName:ne,lineNumber:186,columnNumber:5}},i)}var se=o.exports.memo(ae),ie="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/FormRowsWrapper.jsx";function re(e){var t=e.hookProps;return u.createElement(v.SplunkThemeProvider,s({},x,{__self:this,__source:{fileName:ie,lineNumber:17,columnNumber:5}}),u.createElement(j,{hookProps:t,__self:this,__source:{fileName:ie,lineNumber:18,columnNumber:7}},u.createElement(se,{__self:this,__source:{fileName:ie,lineNumber:19,columnNumber:9}})))}var oe=h("2038-01-19T03:14:07Z"),ue=["aws_cloudwatch","aws_config","aws_config_rule","splunk_ta_aws_sqs"],le=["aws_config","aws_config_rule","splunk_ta_aws_sqs"],ce={CloudTrail:"aws:cloudtrail",Config:"aws:config",S3AccessLogs:"aws:s3:accesslogs",CloudFrontAccessLogs:"aws:cloudfront:accesslogs",ELBAccessLogs:"aws:elb:accesslogs",CustomLogs:"aws:s3"},de={cloudtrail:"aws:cloudtrail","s3:accesslogs":"aws:s3:accesslogs","cloudfront:accesslogs":"aws:cloudfront:accesslogs","elb:accesslogs":"aws:elb:accesslogs"},fe=function(){function n(e,a,s,i,r){t(this,n),this.globalConfig=e,this.serviceName=a,this.state=s,this.mode=i,this.util=r,this._debouncedNameChange=this.debounce(this._nameChange.bind(this),200),this.context=k(e,a)}return e(n,[{key:"onCreate",value:function(){var e=this,t=p("button[label='Cancel']");t&&t.on("click",(function(t){return e._removeExtraParamsFromURL()}))}},{key:"debounce",value:function(e,t){var n;return function(){for(var a=arguments.length,s=new Array(a),i=0;i<a;i++)s[i]=arguments[i];clearTimeout(n),n=setTimeout((function(){e.apply(void 0,s)}),t)}}},{key:"onChange",value:function(e,t,n){if("s3_file_decoder"===e){var a=ce[t];this._setValue("sourcetype",a)}if("distribution_id"===e){var s=t+".%Y-%m-%d-";this._setValue("log_name_format",s)}"aws_config"===this.serviceName&&"aws_account"===e&&window.setAccount(n.data.aws_account.value),"splunk_ta_aws_sqs"===this.serviceName&&"aws_account"===e&&window.setAccount(n.data.aws_account.value),"aws_config_rule"===this.serviceName&&"account"===e&&window.setAccount(n.data.account.value)}},{key:"onRender",value:function(){var e=this,t=this._getInputService(),n=t.input,a=t.service;if("edit"===this.mode||"clone"===this.mode){var s=window.location.toString().split("?"),i="".concat(s[0],"?service=").concat(a,"&input=").concat(n,"&action=").concat(this.mode);setTimeout((function(){return window.history.pushState({},"",i)}))}var r=p("form > div");if(r.length>0){var o=R(a);p(r[0]).append(o)}var l,c,d,f,_,m=N().find((function(e){return e.service===a&&e.input===n}));if(m){var v=g(m,["service","input"]);Object.keys(v).forEach((function(t){e._setValue(t,v[t])}))}if(le.includes(this.serviceName)){if(this.account=this.state.data["aws_config_rule"===this.serviceName?"account":"aws_account"].value,this.initFormRows={},"edit"===this.mode)if("aws_config_rule"===this.serviceName){var b=JSON.parse(this.state.data.region.value),S=JSON.parse(this.state.data.rule_names.value).map((function(e){return e.split(",")}));b.forEach((function(t,n){e.initFormRows[Date.now().toString(36)+Math.random().toString(36).substr(2)]={region:t,rules:S[n]}}))}else{var y=JSON.parse(this.state.data.aws_region.value),k=null;k="splunk_ta_aws_sqs"===this.serviceName?JSON.parse(this.state.data.sqs_queues.value).map((function(e){return e.split(",")})):JSON.parse(this.state.data.sqs_queue.value),y.forEach((function(t,n){e.initFormRows[Date.now().toString(36)+Math.random().toString(36).substr(2)]={region:t,queues:k[n]}}))}l="#group_selection",c=function(){w.render(u.createElement(re,{hookProps:{initFormRows:e.initFormRows,setFormState:e.util.setState,serviceName:e.serviceName,initAccount:e.account},__self:e,__source:{fileName:"/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/Hook.js",lineNumber:190,columnNumber:13}}),document.getElementById("group_selection"))},d=500,f=9e3,_=Date.now(),function e(){null!=document.querySelector(l)?c():setTimeout((function(){f&&Date.now()-_>f||e()}),d)}()}if("aws_billing"===this.serviceName){if(null===this.state.data.initial_scan_datetime.value||""===this.state.data.initial_scan_datetime.value){var x=h().utc().subtract(3,"months").startOf("month").format("YYYY-MM-DDTHH:mm:ss")+"Z";this._setValue("initial_scan_datetime",x)}}else if("aws_billing_cur"===this.serviceName){if(null===this.state.data.start_date.value||""===this.state.data.start_date.value){var q=h().utc().subtract(3,"months").startOf("month").format("YYYY-MM");this._setValue("start_date",q)}}else if("aws_s3"===this.serviceName){if(null===this.state.data.initial_scan_datetime.value||""===this.state.data.initial_scan_datetime.value){var E=h().utc().format("YYYY-MM-DDTHH:mm:ss")+"Z";this._setValue("initial_scan_datetime",E)}}else if("aws_sqs_based_s3"===this.serviceName&&(null===this.state.data.sourcetype.value||""===this.state.data.sourcetype.value)){var F=ce[this.state.data.s3_file_decoder.value];this._setValue("sourcetype",F)}if("aws_s3"===this.serviceName)"aws_cloudtrail"!==n&&this._hideField("ct_blacklist"),"others"!==n&&(this._hideField(["whitelist","blacklist"]),this._disabledField("sourcetype"));else if("splunk_ta_aws_logs"===this.serviceName){"cloudfront_access_logs"===n&&this._hideField("distribution_id",!0);var j=de[this.state.data.log_type.value];this._setValue("sourcetype",j);var M=h().utc().subtract(7,"days").format("YYYY-MM-DD");if(this._setValue("log_start_date",M),this._disabledField(["log_type","sourcetype"]),"create"!==this.mode&&"cloudfront_access_logs"===n){var O=this.state.data.log_name_format.value;-1!==O.indexOf(".%Y-%m-%d-")&&(O=O.substring(0,O.length-".%Y-%m-%d-".length)),this._setValue("distribution_id",O),"edit"===this.mode&&this._disabledField("distribution_id")}}else"aws_sqs_based_s3"===this.serviceName?"others"!==n&&this._disabledField(["s3_file_decoder","sourcetype"]):"aws_kinesis"===this.serviceName&&"vpc_flow_logs"===n&&this._disabledField(["format","encoding","sourcetype"])}},{key:"onSave",value:function(e){if("splunk_ta_aws_logs"===this.serviceName&&"cloudfront:accesslogs"===e.log_type){if(null==e.log_name_format)return this.util.setErrorFieldMsg("distribution_id","Field Distribution ID is required."),!1;this._setValue("distribution_id",null)}else if("aws_cloudwatch"===this.serviceName){if("period"in e&&"polling_interval"in e){var t=e.polling_interval/e.period;if(Math.floor(t)!==t)return this.util.setErrorMsg('The number of "Polling Interval" field should be a multiple of "Granularity".'),!1}}else if("aws_s3"===this.serviceName){if("terminal_scan_datetime"in e){var n=e.terminal_scan_datetime;try{if((n=h(n))>oe)return this.util.setErrorFieldMsg("terminal_scan_datetime","The max supported timestamp is 2038-01-19T03:14:07Z due to Year 2038 problem"),!1;this.util.clearAllErrorMsg()}catch(e){return!1}}}else if("aws_sqs_based_s3"===this.serviceName){if(e.aws_account&&e.sqs_queue_region&&e.sqs_queue_url)return this._validateSQSqueue(e)}return!0}},{key:"onSaveSuccess",value:function(){this._removeExtraParamsFromURL()}},{key:"onSaveFail",value:function(){if("splunk_ta_aws_logs"===this.serviceName&&"cloudfront:accesslogs"===this.state.data.log_type.value){var e=this.state.data.log_name_format.value;if(null!==e){var t=e.split(".")[0];this._setValue("distribution_id",t)}}}},{key:"onEditLoad",value:function(){var e=this;ue.includes(this.serviceName)&&this._fetchConflictFields(this.serviceName).done((function(){if(Object.keys(e._conflict_fields||{}).length>0){var t=e.context.entity,n="The following fields have conflict. ";n+=Object.keys(e._conflict_fields||{}).map((function(n){"disabled"!==n&&e.util.setErrorFieldMsg(n,"");var a=t.find((function(e){return e.field===n})),s=a?a.label:n;return"".concat(s," = [").concat(e._conflict_fields[n].join(", "),"]")})).join(", "),n+=". Please resolve the conflict in conf file first.",e.util.setErrorMsg(n)}}))}},{key:"_validateSQSqueue",value:function(e){var t="splunk_ta_aws/splunk_ta_aws_sqs_queue_attributes?aws_account=".concat(e.aws_account,"&aws_region=").concat(e.sqs_queue_region,"&sqs_queue_url=").concat(e.sqs_queue_url,"&private_endpoint_enabled=").concat(e.private_endpoint_enabled,"&sts_private_endpoint_url=").concat(e.sts_private_endpoint_url,"&sqs_private_endpoint_url=").concat(e.sqs_private_endpoint_url,"&output_mode=json"),n=e.aws_iam_role;n&&(t+="&aws_iam_role=".concat(n));var a=c(t,{app:"Splunk_TA_aws",sharing:"app"}),s=e.using_dlq;try{var i=new XMLHttpRequest;if(i.open("GET",a,!1),i.setRequestHeader("X-Splunk-Form-Key",d),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("Content-Type","application/json"),i.send(),200!==i.status)return this.util.setErrorFieldMsg("sqs_queue_url","The SQS Queue entered may not be present in the given region. "),!1;var r=JSON.parse(i.responseText).entry[0].content,o=r.VisibilityTimeout,u=r.RedrivePolicy;if(0!==s&&!u)return this.util.setErrorFieldMsg("sqs_queue_url","Enabling dead letter queue is required for the SQS queue in this input. "),!1;if(0!==s&&o<300)return this.util.setErrorFieldMsg("sqs_queue_url","It is recommended to set VisibilityTimeout no smaller than 5 minutes for specified SQS queue. "),!1}catch(e){return this.util.setErrorFieldMsg("sqs_queue_url","validation of selected SQS queue failed. ERROR : ".concat(e)),!1}return!0}},{key:"_nameChange",value:function(e){}},{key:"_getInputService",value:function(){this.urlParams=this._extractQuery();var e=this.urlParams,t=e.input,n=e.service;if(!t||"edit"===this.mode||"clone"===this.mode){var a=this._getNormalizeData();t=y(a,this.serviceName)}return{input:t,service:n}}},{key:"_removeExtraParamsFromURL",value:function(){var e=window.location.toString().split("?");2===e.length&&setTimeout((function(){return window.history.pushState({},"",e[0])}))}},{key:"_extractQuery",value:function(){var e=document.location.search||document.location.hash;if(e&&0!==e.length){var t=e.indexOf("?")+1||0,n=e.substring(t).split("&"),a={};return n.forEach((function(e){var t=e.split("=");1===t.length?a[t[0]]=null:a[t[0]]=t[1]})),a}}},{key:"_setValue",value:function(e,t){this.util.setState((function(n){var s=a({},n.data);return s[e].value=t,{data:s}}))}},{key:"_hideField",value:function(e,t){var n=this;b(e)||(e=[e]);var s,r=i(e);try{var o=function(){var e=s.value;n.util.setState((function(n){var s=a({},n.data);return s[e].display=!!t,{data:s}}))};for(r.s();!(s=r.n()).done;)o()}catch(e){r.e(e)}finally{r.f()}}},{key:"_disabledField",value:function(e){var t=this;b(e)||(e=[e]);var n,s=i(e);try{var r=function(){var e=n.value;t.util.setState((function(t){var n=a({},t.data);return n[e].disabled=!0,{data:n}}))};for(s.s();!(n=s.n()).done;)r()}catch(e){s.e(e)}finally{s.f()}}},{key:"_fetchConflictFields",value:function(e){var t=this,n=S.exports.Deferred(),a=c("splunk_ta_aws_"+e,{app:"Splunk_TA_aws",sharing:"app"});return fetch(a+"?output_mode=json").then((function(e){return e.json()})).then((function(e){if(e.entry!==[])for(var a=0;a<e.entry.length;a++)e.entry[a].name===t.state.data.name.value&&"_conflict_fields"in e.entry[a].content&&(t._conflict_fields=JSON.parse(e.entry[a].content._conflict_fields));n.resolve()})),n}},{key:"_getNormalizeData",value:function(){var e=this,t={};return Object.keys(this.state.data).forEach((function(n){t[n]=e.state.data[n].value})),t}}]),n}();export{fe as default};
//# sourceMappingURL=Hook.js.map
